

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Workflows &mdash; miaaim 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Parameter Reference" href="parameters.html" />
    <link rel="prev" title="Folder Structure" href="directory.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: 5DADE2" >
          

          
            <a href="index.html" class="icon icon-home"> miaaim
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Nextflow User Guide / Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#linux-os-x">Linux / OS X</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#windows">Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#installing-miaaim-in-python">Installing MIAAIM in Python</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quick_start.html#prototype-001">prototype-001</a><ul>
<li class="toctree-l3"><a class="reference internal" href="quick_start.html#download-data">Download Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="quick_start.html#image-preprocessing">Image Preprocessing</a></li>
<li class="toctree-l3"><a class="reference internal" href="quick_start.html#image-registration">Image Registration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="directory.html">Folder Structure</a><ul>
<li class="toctree-l2"><a class="reference internal" href="directory.html#input">input</a></li>
<li class="toctree-l2"><a class="reference internal" href="directory.html#hdiprep">hdiprep</a></li>
<li class="toctree-l2"><a class="reference internal" href="directory.html#hdireg">hdireg</a></li>
<li class="toctree-l2"><a class="reference internal" href="directory.html#docs">docs</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Workflows</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#image-preparation-hdiprep">Image Preparation (HDIprep)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#yaml-parameter-file-input-basics">YAML Parameter File Input Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#high-parameter-image-processing">High-Parameter Image Processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#histological-image-processing">Histological Image Processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hdiprep-implementation-guide">HDIprep Implementation Guide</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#image-registration-hdireg">Image Registration (HDIreg)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hdireg-implementation-guide">HDIreg Implementation Guide</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tissue-state-modelling-patchmap">Tissue State Modelling (PatchMAP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cross-system-tissue-information-transfer-i-patchmap">Cross-System/Tissue Information Transfer (i-PatchMAP)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="parameters.html">Parameter Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="parameters.html#nextflow">Nextflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters.html#hdiprep">HDIprep</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters.html#hdireg">HDIreg</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#docker-singularity-containers">Docker/Singularity Containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#resource-allocation">Resource Allocation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#memory">Memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#cpu">CPU</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#preset-resource-allocation-options">Preset Resource Allocation Options</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#adding-imaging-modalities">Adding Imaging Modalities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="contributing.html#importing-new-modalities-adding-file-formats">Importing New Modalities / Adding File Formats</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">MIAAIM in Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="python.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="python.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#usage-without-docker-install-with-pip">Usage without Docker / Install with Pip</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#reproducibility-with-pip">Reproducibility with Pip</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#docker">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#hdi-utility-functions-hdi-utils">HDI Utility Functions (hdi-utils)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="python-workflows.html">Workflow Implementations in Python</a><ul>
<li class="toctree-l2"><a class="reference internal" href="python-workflows.html#image-preparation-hdiprep">Image Preparation (HDIprep)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="python-workflows.html#steady-state-umap-compression">Steady-state UMAP compression</a></li>
<li class="toctree-l3"><a class="reference internal" href="python-workflows.html#histological-image-processing">Histological Image Processing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="python-workflows.html#image-registration-hdireg">Image Registration (HDIreg)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="python-workflows.html#elastix">elastix</a></li>
<li class="toctree-l3"><a class="reference internal" href="python-workflows.html#transformix">transformix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="python-workflows.html#tissue-state-modeling-patchmap">Tissue State Modeling (PatchMAP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="python-workflows.html#cross-system-tissue-information-transfer-i-patchmap">Cross-System/Tissue Information Transfer (i-PatchMAP)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="jupyter.html">Jupyter Notebook Zoo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="jupyter.html#image-preparation-hdiprep">Image Preparation (HDIprep)</a></li>
<li class="toctree-l2"><a class="reference internal" href="jupyter.html#image-registration-hdireg">Image Registration (HDIreg)</a></li>
<li class="toctree-l2"><a class="reference internal" href="jupyter.html#id1">Image Registration (HDIreg)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api.html#image-preparation-hdiprep">Image Preparation (HDIprep)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api.html#module-hdiprep.HDIprep.hdi_prep">hdi_prep</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.html#module-hdiprep.HDIprep.utils">utils</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api.html#image-registration-hdireg">Image Registration (HDIreg)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api.html#module-hdireg.HDIreg.elastix">elastix</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.html#module-hdireg.HDIreg.transformix">transformix</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.html#id7">utils</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api.html#tissue-state-modeling-patchmap">Tissue State Modeling (PatchMAP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#cross-system-tissue-information-transfer-i-patchmap">Cross-System/Tissue Information Transfer (i-PatchMAP)</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Background on MIAAIM</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="elastix.html">Elastix Basics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="elastix.html#registration-parameter-files-elastix">Registration Parameter Files (Elastix)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="elastix.html#multi-channel-input">Multi-channel Input</a></li>
<li class="toctree-l3"><a class="reference internal" href="elastix.html#single-channel-input">Single-channel Input</a></li>
<li class="toctree-l3"><a class="reference internal" href="elastix.html#help-the-registration-with-manual-landmarks">Help the Registration with Manual Landmarks</a></li>
<li class="toctree-l3"><a class="reference internal" href="elastix.html#outputs">Outputs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="elastix.html#applying-transformations-transformix">Applying Transformations (Transformix)</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Roadmap</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">MIAAIM Roadmap</a><ul>
<li class="toctree-l2"><a class="reference internal" href="roadmap.html#miaaim-0-0-1">MIAAIM 0.0.1</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#adding-imaging-modalities">Adding Imaging Modalities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="contributing.html#importing-new-modalities-adding-file-formats">Importing New Modalities / Adding File Formats</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">FAQs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="faqs.html">FAQs</a></li>
</ul>
<p class="caption"><span class="caption-text">Contact</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact Information</a></li>
</ul>
<p class="caption"><span class="caption-text">Funding</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="funding.html">Funding</a></li>
</ul>
<p class="caption"><span class="caption-text">License</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>
<p class="caption"><span class="caption-text">Acknowledgements</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="acknowledgements.html">Acknowledgements</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">miaaim</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Workflows</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/JoshuaHess12/miaaim/blob/0.0.1workflows.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="workflows">
<span id="workflows-to-workflows"></span><h1>Workflows<a class="headerlink" href="#workflows" title="Permalink to this headline">¶</a></h1>
<p>MIAAIM contains 4 major workflows:</p>
<p>1. High-Dimensional Image Preparation with the
<a class="reference internal" href="#hdiprep-to-hdiprep"><span class="std std-ref">HDIprep workflow</span></a></p>
<p>2. High-Dimensional Image Registration with the
<a class="reference internal" href="#hdireg-to-hdireg"><span class="std std-ref">HDIreg workflow</span></a></p>
<p>3. Tissue state modelling with the
<a class="reference internal" href="#patchmap-to-patchmap"><span class="std std-ref">PatchMAP workflow</span></a> and</p>
<p>4. Cross-system/tissue information transfer with the
<a class="reference internal" href="#i-patchmap-to-i-patchmap"><span class="std std-ref">i-PatchMAP workflow</span></a>.</p>
<p>For a comprehensive table of input options for these workflows, see the
<a class="reference internal" href="parameters.html#parameter-reference-to-parameter-reference"><span class="std std-ref">Parameter Reference</span></a> section.
Up-to-date input options and docker containerized versions of each workflow
are available on GitHub:</p>
<span id="workflow-github-repositories-to-workflow-github-repositories"></span><table class="colwidths-given docutils align-default" id="id1">
<caption><span class="caption-text">Workflow GitHub Repositories</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Workflow</p></th>
<th class="head"><p>Resource</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>hdiprep</p></td>
<td><p><a class="reference external" href="https://github.com/JoshuaHess12/hdi-prep">https://github.com/JoshuaHess12/hdi-prep</a></p></td>
</tr>
<tr class="row-odd"><td><p>hdireg</p></td>
<td><p><a class="reference external" href="https://github.com/JoshuaHess12/hdi-reg">https://github.com/JoshuaHess12/hdi-reg</a></p></td>
</tr>
<tr class="row-even"><td><p>patchmap/i-patchmap</p></td>
<td><p><a class="reference external" href="https://github.com/JoshuaHess12/patchmap">https://github.com/JoshuaHess12/patchmap</a></p></td>
</tr>
</tbody>
</table>
<div class="section" id="image-preparation-hdiprep">
<span id="hdiprep-to-hdiprep"></span><h2>Image Preparation (HDIprep)<a class="headerlink" href="#image-preparation-hdiprep" title="Permalink to this headline">¶</a></h2>
<p>Image preparation begins the workflow for MIAAIM, and it is designed to provide
processed images to the HDIreg image registration workflow. HDIprep can process
high-parameter images as well as histological stains.</p>
<p>HDIprep works by chaining together multiple operations in sequence to process images.
Each operation is indicated as an argument in a YAML parameter file that is passed
to the HDIprep workflow.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If your images have more than 3 channels, you should apply
HDIprep as indicated in the
<a class="reference internal" href="#high-dimensional-input-to-high-dimensional-input"><span class="std std-ref">High Dimensional Image Processing</span></a>
section. If your images have 3 or less channels, you should apply HDIprep as
indicated in the <a class="reference internal" href="#histological-input-to-histological-input"><span class="std std-ref">Histological Image Processing</span></a>
section.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>All HDIprep parameter files should end with the <code class="code docutils literal notranslate"><span class="pre">ExportNifti1</span></code> function
so that an output is produced!</p>
</div>
<div class="section" id="yaml-parameter-file-input-basics">
<h3>YAML Parameter File Input Basics<a class="headerlink" href="#yaml-parameter-file-input-basics" title="Permalink to this headline">¶</a></h3>
<p>HDIprep parses YAML parameter files as Python would. Input to the HDIprep workflow
requires two sections to be completed in YAML parameter files for both a fixed
image, which will remain unmoved during image registration, and a moving image,
which will be transformed. The sections that must be completed are the <code class="code docutils literal notranslate"><span class="pre">ProcessingSteps</span></code>
and <code class="code docutils literal notranslate"><span class="pre">InputOptions</span></code> sections. Below is an example parameter file for
image compression with HDIprep:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ImportOptions</span><span class="p">:</span>                                 <span class="c1"># indicates import options</span>
  <span class="n">flatten</span><span class="p">:</span> <span class="kc">True</span>                                <span class="c1"># flatten the image for dimension reduction</span>
  <span class="n">subsample</span><span class="p">:</span> <span class="kc">True</span>                              <span class="c1"># subsample pixels</span>
  <span class="n">method</span><span class="p">:</span> <span class="s1">&#39;grid&#39;</span>                               <span class="c1"># method to use for subsampling</span>
  <span class="n">grid_spacing</span><span class="p">:</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>                          <span class="c1"># subsampling grid spacing</span>

<span class="n">ProcessingSteps</span><span class="p">:</span>                               <span class="c1"># indicates processing steps</span>
  <span class="o">-</span> <span class="n">RunOptimalUMAP</span><span class="p">:</span>                            <span class="c1"># steady state UMAP compression</span>
      <span class="n">n_neighbors</span><span class="p">:</span> <span class="mi">15</span>                          <span class="c1"># nearest neighbors for UMAP</span>
      <span class="n">metric</span><span class="p">:</span> <span class="s1">&#39;euclidean&#39;</span>                      <span class="c1"># metric for UMAP</span>
      <span class="n">random_state</span><span class="p">:</span> <span class="mi">1221</span>                       <span class="c1"># random state for UMAP reproducibility</span>
  <span class="o">-</span> <span class="n">SpatiallyMapUMAP</span>                           <span class="c1"># spatial reconstruction of UMAP embedding</span>
  <span class="o">-</span> <span class="n">ExportNifti1</span>                               <span class="c1"># export processed image as NIfTI</span>
</pre></div>
</div>
<p>1. <code class="code docutils literal notranslate"><span class="pre">ImportOptions</span></code> parameters are indicated as key-value pairs
with a colon (<code class="code docutils literal notranslate"><span class="pre">:</span></code>) For example,
the above snippet will import high-dimensional image data, it will flatten it
into an array with the <code class="code docutils literal notranslate"><span class="pre">flatten:</span> <span class="pre">True</span></code>, subsample the flattened array with
<code class="code docutils literal notranslate"><span class="pre">subsample:</span> <span class="pre">True</span></code> using a uniformly spaced grid with grid spacing of 5 pixels.</p>
<p>2. <code class="code docutils literal notranslate"><span class="pre">ProcessingSteps</span></code> in HDIprep are indicated
with the <code class="code docutils literal notranslate"><span class="pre">-</span></code> flag. These steps will be run sequentially. Parameters within each
processing step are indicated as key-value pairs with a colon (<code class="code docutils literal notranslate"><span class="pre">:</span></code>) For example,
the above snippet will run steady state UMAP compression using the <code class="code docutils literal notranslate"><span class="pre">RunOptimalUMAP</span></code>
function with the given <code class="code docutils literal notranslate"><span class="pre">n_neighbors</span></code>, <code class="code docutils literal notranslate"><span class="pre">metric</span></code>, and <code class="code docutils literal notranslate"><span class="pre">random_state</span></code> parameters
specified.
Then, pixels in the UMAP embedding will be mapped to their respective spatial location
on the tissue with using the <code class="code docutils literal notranslate"><span class="pre">SpatiallyMapUMAP</span></code> function. This reconstructed
UMAP compressed image will then be
exported as an image with the <code class="code docutils literal notranslate"><span class="pre">ExportNifti1</span></code> function.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>MIAAIM expects the NIfTI format (<code class="code docutils literal notranslate"><span class="pre">.nii</span></code> suffix) as input for the HDIreg
workflow. HDIprep therefore
exports processed images using the <code class="code docutils literal notranslate"><span class="pre">ExportNifti1</span></code>
function. NIfTI provides memory-mapping capabilities within Python
that save RAM in HDIreg. However, OME-TIF, HDF5, imzML, and NIfTI can be used as input
formats for HDIprep!</p>
</div>
</div>
<div class="section" id="high-parameter-image-processing">
<span id="high-dimensional-input-to-high-dimensional-input"></span><h3>High-Parameter Image Processing<a class="headerlink" href="#high-parameter-image-processing" title="Permalink to this headline">¶</a></h3>
<div class="figure align-default">
<a class="reference internal image-reference" href="_images/Figure2-5-panelA.jpg"><img alt="_images/Figure2-5-panelA.jpg" src="_images/Figure2-5-panelA.jpg" style="width: 100%;" /></a>
</div>
<p>MIAAIM processes high-parameter images using a newly developed image
compression method. This method is based off of UMAP. The HDIprep workflow adds functionality
to subsample images for rapid UMAP compression, and it can embed data in
a dimensionality that preserves data information while minimizing the
necessary dimensionality of the embedding space (number of channels in the
compressed image).</p>
<p>Implementing this new compression method is indicated in the HDIprep YAML parameter
file under <code class="code docutils literal notranslate"><span class="pre">ProcessingSteps</span></code> as <code class="code docutils literal notranslate"><span class="pre">RunOptimalUMAP</span></code>. After an embedding
is created with <code class="code docutils literal notranslate"><span class="pre">RunOptimalUMAP</span></code>, map the pixels back to their spatial location
with <code class="code docutils literal notranslate"><span class="pre">SpatiallyMapUMAP</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The HDIprep workflow can also apply a neural network variant of UMAP to
scale to very large images. Implement this version by using the function
<code class="code docutils literal notranslate"><span class="pre">RunOptimalParametricUMAP</span></code>.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The HDIprep workflow can accept a mask in the TIFF format to focus dimension
reduction on a region of interest on a larger section. This could be useful
for very large noisy images. Use this feature by specifying
<code class="code docutils literal notranslate"><span class="pre">mask:</span> <span class="pre">True</span></code> under <code class="code docutils literal notranslate"><span class="pre">ImportOptions</span></code>. Make sure the mask is
in the input directory with your image data and be sure to name it with your
image’s name followed by the suffix <code class="code docutils literal notranslate"><span class="pre">-mask</span></code>. For example, the mask associated
with a a moving image named <code class="code docutils literal notranslate"><span class="pre">moving.nii</span></code> should be named <code class="code docutils literal notranslate"><span class="pre">moving-mask.tif</span></code>.
See this in action below:</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="_images/input-mask-folder-example.png"><img alt="_images/input-mask-folder-example.png" src="_images/input-mask-folder-example.png" style="width: 100%;" /></a>
</div>
</div>
</div>
<div class="section" id="histological-image-processing">
<span id="histological-input-to-histological-input"></span><h3>Histological Image Processing<a class="headerlink" href="#histological-image-processing" title="Permalink to this headline">¶</a></h3>
<p>MIAAIM supports parallelized image smoothing and morphological operations, such
as thresholding to create masks, opening, closing, and filling for histological
image preprocessing. These are typically applied as sequential image processing
options.</p>
</div>
<div class="section" id="hdiprep-implementation-guide">
<h3>HDIprep Implementation Guide<a class="headerlink" href="#hdiprep-implementation-guide" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-given docutils align-default" id="id2">
<caption><span class="caption-text">HDIprep Implementation Guide</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Image Data Type</p></th>
<th class="head"><p>Suggested HDIprep YAML File Contents</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>High-Dimensional (&gt;3 channels)</p></td>
<td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ImportOptions</span><span class="p">:</span>
  <span class="n">flatten</span><span class="p">:</span> <span class="kc">True</span>
  <span class="n">subsample</span><span class="p">:</span> <span class="kc">True</span>
  <span class="n">method</span><span class="p">:</span> <span class="s1">&#39;grid&#39;</span>
  <span class="n">grid_spacing</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>

<span class="n">ProcessingSteps</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">RunOptimalUMAP</span><span class="p">:</span>
      <span class="n">n_neighbors</span><span class="p">:</span> <span class="mi">15</span>
      <span class="n">metric</span><span class="p">:</span> <span class="s1">&#39;euclidean&#39;</span>
      <span class="n">landmarks</span><span class="p">:</span> <span class="mi">3000</span>
      <span class="n">dim_range</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
      <span class="n">random_state</span><span class="p">:</span> <span class="mi">1221</span>
  <span class="o">-</span> <span class="n">SpatiallyMapUMAP</span>
  <span class="o">-</span> <span class="n">ExportNifti1</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>Low-Dimensional (&lt;=3 channels)</p></td>
<td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ImportOptions</span><span class="p">:</span>
  <span class="n">flatten</span><span class="p">:</span> <span class="kc">False</span>
  <span class="n">subsample</span><span class="p">:</span> <span class="kc">None</span>
  <span class="n">mask</span><span class="p">:</span> <span class="kc">True</span>        <span class="c1"># True if you have a custom input mask, otherwise set to False</span>
<span class="n">ProcessingSteps</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">RunOptimalUMAP</span><span class="p">:</span>
      <span class="n">n_neighbors</span><span class="p">:</span> <span class="mi">15</span>
      <span class="n">metric</span><span class="p">:</span> <span class="s1">&#39;euclidean&#39;</span>
      <span class="n">landmarks</span><span class="p">:</span> <span class="mi">3000</span>
      <span class="n">dim_range</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
      <span class="n">random_state</span><span class="p">:</span> <span class="mi">1221</span>
  <span class="o">-</span> <span class="n">SpatiallyMapUMAP</span>
  <span class="o">-</span> <span class="n">ExportNifti1</span>

<span class="n">ProcessingSteps</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">MedianFilter</span><span class="p">:</span>
      <span class="n">filter_size</span><span class="p">:</span> <span class="mi">25</span>   <span class="c1"># median filtering</span>
      <span class="n">parallel</span><span class="p">:</span> <span class="kc">True</span>
  <span class="o">-</span> <span class="n">Threshold</span><span class="p">:</span>
      <span class="nb">type</span><span class="p">:</span> <span class="s1">&#39;otsu&#39;</span>      <span class="c1"># create mask with thresholding</span>
  <span class="o">-</span> <span class="n">Open</span><span class="p">:</span>
      <span class="n">disk_size</span><span class="p">:</span> <span class="mi">20</span>     <span class="c1"># morphological opening</span>
      <span class="n">parallel</span><span class="p">:</span> <span class="kc">True</span>
  <span class="o">-</span> <span class="n">Close</span><span class="p">:</span>
      <span class="n">disk_size</span><span class="p">:</span> <span class="mi">40</span>     <span class="c1"># morphological closing</span>
      <span class="n">parallel</span><span class="p">:</span> <span class="kc">True</span>
  <span class="o">-</span> <span class="n">Fill</span>                <span class="c1"># fill holes in mask</span>
  <span class="o">-</span> <span class="n">Open</span><span class="p">:</span>
      <span class="n">disk_size</span><span class="p">:</span> <span class="mi">15</span>     <span class="c1"># morphological opening</span>
      <span class="n">parallel</span><span class="p">:</span> <span class="kc">True</span>
  <span class="o">-</span> <span class="n">ApplyManualMask</span>     <span class="c1"># apply manual input mask</span>
  <span class="o">-</span> <span class="n">NonzeroBox</span>          <span class="c1"># perform nonzero slicing for constant padding</span>
  <span class="o">-</span> <span class="n">ApplyMask</span>
    <span class="o">-</span> <span class="n">ExportNifti1</span>      <span class="c1"># export as nifti</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The above processing steps are based on histological images scaled to a
resolution of ~1.2 micron/pixel.</p>
</div>
</div>
</div>
<div class="section" id="image-registration-hdireg">
<span id="hdireg-to-hdireg"></span><h2>Image Registration (HDIreg)<a class="headerlink" href="#image-registration-hdireg" title="Permalink to this headline">¶</a></h2>
<div class="figure align-default">
<a class="reference internal image-reference" href="_images/Figure2-5-panelB.jpg"><img alt="_images/Figure2-5-panelB.jpg" src="_images/Figure2-5-panelB.jpg" style="width: 100%;" /></a>
</div>
<p>Image registration in MIAAIM is performed in the HDIreg workflow.
Like the HDIprep workflow, HDIreg can process
high-parameter images as well as histological stains.</p>
<p>HDIreg works by supplying an Elastix parameter file in a pairwise registration
procedure between a fixed image (reference image), and a moving image.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If your images have more than 3 channels, you should apply
HDIprep as indicated in the
<a class="reference internal" href="#high-dimensional-input-to-high-dimensional-input"><span class="std std-ref">High Dimensional Image Processing</span></a>
section. If your images have 3 or less channels, you should apply HDIprep as
indicated in the <a class="reference internal" href="#histological-input-to-histological-input"><span class="std std-ref">Histological Image Processing</span></a>
section.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>All HDIprep parameter files should end with the <code class="code docutils literal notranslate"><span class="pre">ExportNifti1</span></code> function
so that an output is produced!</p>
</div>
<div class="section" id="hdireg-implementation-guide">
<h3>HDIreg Implementation Guide<a class="headerlink" href="#hdireg-implementation-guide" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-given docutils align-default" id="id3">
<caption><span class="caption-text">HDIreg Implementation Guide</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Image Data Type</p></th>
<th class="head"><p>Suggested HDIreg Elastix Text File Contents</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Mixed High (&gt;3) and Low (&lt;= 3 channels) Dimensional Images</p></td>
<td><p>Registration “MultiResolutionRegistrationWithFeatures” Metric “KNNGraphAlphaMutualInformation” ImageSampler “MultiInputRandomCoordinate”</p></td>
</tr>
<tr class="row-odd"><td><p>High (&gt;3 channels) Dimensional Images</p></td>
<td><p>Registration “MultiResolutionRegistrationWithFeatures” Metric “KNNGraphAlphaMutualInformation” ImageSampler “MultiInputRandomCoordinate”</p></td>
</tr>
<tr class="row-even"><td><p>Low (&lt;=3 channels) Dimensional Images</p></td>
<td><p>Registration “MultiResolutionRegistration” Metric “AdvancedMattesMutualInformation” ImageSampler “RandomCoordinate”</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="tissue-state-modelling-patchmap">
<span id="patchmap-to-patchmap"></span><h2>Tissue State Modelling (PatchMAP)<a class="headerlink" href="#tissue-state-modelling-patchmap" title="Permalink to this headline">¶</a></h2>
<div class="figure align-default">
<a class="reference internal image-reference" href="_images/Figure-4-3-panelA.jpg"><img alt="_images/Figure-4-3-panelA.jpg" src="_images/Figure-4-3-panelA.jpg" style="width: 100%;" /></a>
</div>
<p>Continuity between tissue state in MIAAIM is performed with the PatchMAP workflow.
PatchMAP explicitly constructs a manifold that captures structure between data
manifolds.</p>
<p>PatchMAP is currently implemented in the Python implementation of MIAAIM. See the
<a class="reference internal" href="python-workflows.html#pworkflows-to-pworkflows"><span class="std std-ref">Python workflows</span></a> for an example use case.</p>
</div>
<div class="section" id="cross-system-tissue-information-transfer-i-patchmap">
<span id="i-patchmap-to-i-patchmap"></span><h2>Cross-System/Tissue Information Transfer (i-PatchMAP)<a class="headerlink" href="#cross-system-tissue-information-transfer-i-patchmap" title="Permalink to this headline">¶</a></h2>
<p>i-PatchMAP utilizes the manifold constructed between data
separate data manifolds in the PatchMAP workflow to transfer information from a
reference to a query data set.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="parameters.html" class="btn btn-neutral float-right" title="Parameter Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="directory.html" class="btn btn-neutral float-left" title="Folder Structure" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Joshua Hess.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>